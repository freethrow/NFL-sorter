<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>NFL data mockup</title>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700,900|Playfair+Display:400,900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="design.css" />

    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div id="header">
          <h1 class="title">What's the best city to be an <br />NFL fan?</h1>
          <h3 class="grey">Based on touchdowns, beer, and ticket prices.</h3>
          <p class="lead">
            Lorem ipsum Lorem ipsum dolor sit amet consectetur adipisicing elit.
            Dignissimos laboriosam minus culpa There's more to sports than
            winning. Beer and food are also key...
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 offset-md-4">
          <div class="row">
            <div class="color7 scale"><p>FIRST</p></div>
            <div class="color6 scale"></div>
            <div class="color5 scale"></div>
            <div class="color4 scale"></div>
            <div class="color3 scale"></div>
            <div class="color2 scale"></div>
            <div class="color1 scale"><p>LAST</p></div>
          </div>
          <div class="row">
            <div class="green-left float-left">Best in category</div>
            <div class="magenta-right ml-auto">Worst in category</div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="help">Tap the icons to change the filter</div>
        <table class="table table-bordered table-sm">
          <thead>
            <tr>
              <th scope="" class="center-cell" id="generalClick">
                <img
                  class="header-img mx-auto d-block"
                  src="star.svg"
                  alt="overall"
                /><br />
                BEST OVERALL
              </th>
              <th
                style="width: 13.33%"
                scope="col"
                class="center-cell"
                id="touchdownsClick"
              >
                <img
                  class="header-img mx-auto d-block"
                  src="american_football.svg"
                  alt=""
                /><br />
                TOUCHDOWNS
              </th>
              <th
                style="width: 13.33%"
                scope="col"
                class="center-cell"
                id="ticketsClick"
              >
                <img
                  class="header-img mx-auto d-block"
                  src="ticket.svg"
                  alt=""
                /><br />
                TICKET PRICE
              </th>
              <th
                scope="col"
                class="center-cell"
                id="precipitationClick"
                style="width: 13.33%"
              >
                <img
                  class="header-img mx-auto d-block"
                  src="star.svg"
                  alt="overall"
                /><br />PRECIPITATION
              </th>
              <th
                scope="col"
                class="center-cell d-none d-md-table-cell"
                id="beerClick"
                style="width: 13.33%"
              >
                <img class="header-img mx-auto d-block" src="beer.svg" alt="" />
                <br />BEER PRICE
              </th>
              <th
                scope="col"
                class="center-cell d-none d-md-table-cell"
                id="mcdClick"
                style="width: 13.33%"
              >
                <img
                  class="header-img mx-auto d-block"
                  src="star.svg"
                  alt="overall"
                /><br />McMEAL
              </th>
              <th
                scope="col"
                class="center-cell hidden-xs hidden-sm""
                id="pollutionClick"
                style="width: 13.33%"
              >
                <img
                  class="header-img mx-auto d-block"
                  src="star.svg"
                  alt="overall"
                /><br />POLLUTION
              </th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script src="//d3js.org/d3.v3.min.js"></script>
    <script>
      // set the bilinear color scale

      var cellColor = d3.scale
        .linear()
        .domain([41, 21, 1])
        .range(["#b8327d", "#f4f4f4", "#689736"]);
      console.log(cellColor(41));

      let sort_key = "total_rank";

      // bind on click events to columns
      beerColumn = d3.select("#beerClick");

      beerColumn.on("click", function() {
        let sort_key = "beer_rank";
        parse(sort_key);
      });

      precipitationColumn = d3.select("#precipitationClick");

      precipitationColumn.on("click", function() {
        let sort_key = "precipitation_rank";
        parse(sort_key);
      });

      touchdownsColumn = d3.select("#touchdownsClick");

      touchdownsColumn.on("click", function() {
        let sort_key = "touchdowns_rank";
        parse(sort_key);
      });

      ticketColumn = d3.select("#ticketsClick");

      ticketColumn.on("click", function() {
        let sort_key = "ticket_rank";
        parse(sort_key);
      });

      generalColumn = d3.select("#generalClick");

      generalColumn.on("click", function() {
        let sort_key = "total_rank";
        parse(sort_key);
      });

      mcdColumn = d3.select("#mcdClick");

      mcdColumn.on("click", function() {
        let sort_key = "mcd_rank";
        parse(sort_key);
      });

      pollutionColumn = d3.select("#pollutionClick");

      pollutionColumn.on("click", function() {
        let sort_key = "pollution_rank";
        parse(sort_key);
      });

      // function to sort the data AND populate the table

      function parse(sort_key) {
        d3.csv("ranks.csv", function(error, data) {
          if (error) throw error;

          // the keys are the header rows
          var keys = d3.keys(data[0]);
          console.log(keys);

          var headers = keys.filter(function(key) {
            return key != "id" && key != "sum_of_ranks" && key != "City";
          });

          console.log("headers:");
          console.log(headers);

          data = data.sort(function(a, b) {
            return +a[sort_key] - +b[sort_key];
          });

          render(data);
        });
      }

      // RENDER TABLE
      function render(data) {
        //sort the data by overall ranking
        var tr = d3
          .select("tbody")
          .selectAll("tr")
          .remove();
        // append the rows
        var tr = d3
          .select("tbody")
          .selectAll("tr")
          .data(data)
          .enter()
          .append("tr");

        // for each column append a th

        tr.append("th").html(function(d) {
          console.log(d);
          first_column = `<img class="teamlogo" src="Arizona.gif" alt="Arizona" />
                <span class="city-name">${d.City} ${d.total_rank}</span><br />
                <span class="team-name">${d.Team}</span>
              </th>`;
          return first_column;
        });

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.touchdowns_rank;
          })
          .style("background-color", d => cellColor(d.touchdowns_rank))
          .style("font-size", 0);

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.ticket_rank;
          })
          .style("background-color", d => cellColor(d.ticket_rank))
          .style("font-size", 0);

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.precipitation_rank;
          })
          .style("background-color", d => cellColor(d.precipitation_rank))
          .style("font-size", 0);

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.beer_rank;
          })
          .style("background-color", d => cellColor(d.beer_rank))
          .style("font-size", 0);

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.mcd_rank;
          })
          .style("background-color", d => cellColor(d.mcd_rank))
          .style("font-size", 0);

        tr.append("th")
          .text(function(d) {
            console.log(d);
            return d.pollution_rank;
          })
          .style("background-color", d => cellColor(d.pollution_rank))
          .style("font-size", 0);
      }

      $(document).ready(function() {
        parse(sort_key);
      });
    </script>
  </body>
</html>
